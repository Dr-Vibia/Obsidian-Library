## 背景

共模攻击，Common Modulus Attack，也称为同模攻击。同模攻击利用的大前提就是，RSA体系在生成密钥的过程中使用了相同的模数 n。

对于同一条明文 m ，新手小白 A 和 B 对其进行加密：

$A:C_1≡M^{e_1}\ \mod \ n$

$B:C_2≡M^{e_2}\ \mod \ n$

如果，此时有一个攻击者，同时监听了 A 和 B 接收到的密文。因为模数不变，以及所有的公钥都是公开的，那么利用同模攻击，就可以在不知道的条件下破解明文 M

## 攻击条件：

已知 $n,e_1,e_2,C_1,C_2$

## 解密数学原理：

当 $n$ 一定时，已知 $e_1,e_2,C_1,C_2$

假设 $e_1,e_2$ 互质，即 $gcd(e_1,e_2)=1$
此时有: $e_1s_1+e_2s_2=1$(其中 $s_1,s_2$ 为整数，且一正一负)

通过扩展欧几里得算法，我们可以得到上式的一组解 $(s_1, s_2)$

假设 $s_1$ 为正数，$s_2$ 为负数

因为 $C_1=m^{e_1}\ mod\ n,C_2=m^{e_2}\ mod\ n$
所以:

$(C_1^{s_1}C_2^{s_2})\ mod\ n$
=$((m^{e_1}\ mod\ n)^{s_1} * (m^{e_2}\ mod\ n)^{s_2})\ mod\ n$
=$((m^{e_1s_1+e_2s_2})\ mod\ n)\ mod\ n$
$(由 e_1s_1+e_2s_2=1)$

可得到:
$C_1^{s_1}C_2^{s_2}=m\ mod\ n$

即:
$m=C_1^{s_1}C_2^{s_2}\ mod\ n$

## 例题：

BUU RSA3

```
c1=22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361
n=22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801
e1=11187289
c2=18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397
e2=9647291
```

## 解题脚本：

```python
from libnum import*  
from gmpy2 import*  
n=22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801  
  
c1=22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361  
  
c2=18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397  
  
e1=11187289  
e2=9647291  
s=gcdext(e1,e2)  
m=pow(c1,s[1],n)*pow(c2,s[2],n)%n  
print n2s(m)
```