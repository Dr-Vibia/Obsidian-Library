# 10 密码学协议动物园

1. 本节学习密码学协议。这些协议以之前学习的密码学知识为基础实现了一些“奇妙”的事情！
2. 动物园地图
   - 密码学协议种类繁多，应用广泛。
3. 目录：略。
4. 协议：
   - **通信协议**是为了一个特定目的的数字消息格式与交换规则的形式化描述
     - 协议之于通信，如同算法之于计算
     - 每个人必须知道并同意服从协议
   - 无歧义：每个步骤必须被明确定义且无误解的可能
   - 完备性：对每个可能的情况都必须有一个明确的行为
   - 密码学协议：除了上述属性，还应该不可能比协议中说明的做的更多或者知道的更多
5. 协议类型
   - 仲裁协议：一个仲裁者是一个公正的可信第三方，帮助完成协议
   - 审判协议：一个法官是也是一个公正的可信第三方。与仲裁者不同，其不直接参与协议，而是来审判协议是否正确执行
   - 自强制协议：最佳的协议类型。协议本身保证公平性。
   - 例子：两人平分蛋糕协议。
6. 对协议的攻击
   - 被动攻击：攻击者不影响协议
   - 主动攻击：攻击者更改协议以获得优势
   - 作弊者：攻击者是协议中的一方
     - 被动作弊者：按照协议执行，但试图获得比协议所设定的更多的信息
     - 主动作弊者：在协议进程中干扰协议来作弊
7. 三次传递协议
   - 目的：两方之间无共享密钥下的保密通信
   - 类比：两人同一个箱子来传递一个秘密，该箱子可以上锁
     - 第一步，Alice将秘密放进箱子里，并上一把只有Alice自己有钥匙的锁，发送给Bob
     - 第二步，Bob收到箱子后，也无法打开箱子；在箱子上又上一把只有Bob自己能打开的锁，并发送给Alice
     - 第三步，Alice收到箱子后，打开自己之前上的锁，并发送给Bob；Bob收到箱子后打开自己上的锁，得到秘密
   - 这个方案需要加密方案具有一个性质：$\mathsf{Dec}_{k_1}(\mathsf{Enc}_{k_2}(\mathsf{Enc}_{k_1}(m))) = \mathsf{Enc}_{k_2}(m)$；用两个密钥分别加密两次后，用任意一个密钥解密，得到另一个密钥加密的密文
   - Shamir协议：$p$ 是一个素数，生成 $e,d$ 满足$\gcd(e,p-1)=1$ 并且 $ed \equiv 1 \pmod{p-1}$；加密$c = m^e$，满足上面的性质。
   - 弱点：Alice并不能确定和其通信的真的是Bob本人，Bob也不能确定对方是Alice。中间人攻击可以伪装成双方，与双方分别进行三次传递协议，与双方分别传递一个秘密，而双方并不知情。中间人可以获得Alice发给Bob的秘密，也可以伪造一个秘密发给Bob。
8. 中间人攻击
   - 这里介绍另一种中间人攻击，也叫水桶小队攻击。攻击者与受害双方分别独立建立连接，并且在双方之间中继消息，使得双方以为在和彼此通信。
   - 敌手在中间用自己的密钥来执行协议，交换后的明文没有变化，而Alice和Bob都无法发现。
9. 互锁协议
   - 介绍一种抵御上面的中间人攻击的方法。思路是将两个要交换的密文分成两部分，分别先交换密文的一半，然后再交换另一半。
   - 敌手收到一半密文后，因为没有得到整个密文，无法解密的原本的明文，也就无法伪造密文的一半。
10. 双线性映射
    - 三个循环群之间存在一个关系，称为双线性映射（也叫双线性配对）：两个群中两个元素的对可以被有效映射到第三个群中的元素。前两个群是同一个群，其中的两个元素$aP$和$bP$可以被有效映射到第三个群中的元素$P^{ab}$。由此，得到$G_1$中一对元素$aP$和$bP$与另一对元素$P$和$abP$将映射到$G_2$中的同一个元素。
    - 定理：若映射是有效的，则在$G_1$中的判断式DH问题，即给定$aP$和$bP$，判定一个元素是否是$abP$，就是一个容易的问题，因为可以判断一对元素$(P,xP)$是否映射到$e(P,P)^{ab}$。
    - Weil和Tate配对是两个常用的双线性映射，其中$G_1$是椭圆曲线群，$G_2$是有限域。
11. Jounx密钥交换协议
    - Jounx的一轮、三方密钥协商协议，其中Alice计算密钥$e(bP, cP)^a = e(P, P)^{abc}$；
    - 双线性DH（BDH）假设：给定$\left<P, aP, bP, cP \right>$，计算$e(P, P)^{abc}$是难题；
    - 定理：给定BDH假设，Jounx协议是安全的。
12. 基于身份的加密
    - IBE：直接用接收方的ID作为公钥，需要一个可信第三方来协助，即密钥生成中心KGC。接收方从KGC获得私钥。例如，直接用接收方的email地址作为其公钥，但仍然需要预先获得KGC的公钥，但不再需要证书。
    - 优点：TTP在生成用户的私钥后可以被去掉，从而不需要PKI来分发密钥
    - 弱点：单点失效，隐式的密钥托管
13. Boneh-Franklin的IBE方案
    - 由Boneh和Franklin两人在2001年提出的IBE方案。
    - KGC负责产生一个全局公钥
    - 加密：$\mathsf{Enc}(sP, A, m) = \left< rP, m\oplus H_2(e(H_1(A), sP)^r)\right>$
    - 解密：接收方从KGC获得其私钥$d_{A} = sH_1(A)$，并解密$\mathsf{Dec}(d_{A}, u, v) = v \oplus H_2(e(d_A, u)).$ 
      - 根据私钥无法获知$s$，因为这是一个离散对数问题
    - 正确性：$e(d_A, u) = e(sH_1(A), rP) = e(H_1(A), P)^{sr} = e(H_1(A), sP)^r$
14. 盲签名
    - 签名者在看不见消息的情况下对消息签名
    - 类比隔着一个信封对一个文件盖一个钢印。
    - Chaum的盲签名方案：
      - Alice将消息加密后发给签名者，类比于将文件装进了信封；
      - 签名者对密文签名，类比于隔着信封盖钢印；
      - Alice将加密消息的签名处理后得到原消息的签名，发送给Bob，类比于打开信封，发送带钢印的文件。
15. 群签名
    - 群签名是一种签名方案，一组人中某一个人的签名可以被公开验证是这组人中的某一个人签的，但不能确认到底是谁签的。这组人中有一个组长，他可以确认并证明是谁签的。

16. 环签名
    - 环签名是一种特殊的群签名，但其中不需要组长，从而无法确认到底是谁签的。

17. 秘密共享
    - 一个秘密在一组人中共享，每个人持有秘密的一部分，但当手里的秘密的份数没有达到某个阈值的时候，没有人能还原秘密；而当秘密的份数达到了某个阈值时，可以还原出秘密。

18. Shamir的秘密共享
    - 利用一个线性多项式来分享秘密。秘密是该多项式中常数项，每一份秘密是该多项式的一个点。
    - 优点：信息论安全
    - 缺点：每份秘密的正确性无法验证

19. 门限密码学
    - 至少n个参与方中的t个才可以解密密文或签名消息

20. 承诺方案
    - 互联网上掷硬币：利用哈希函数实现对承诺的绑定和隐藏
21. 零知识证明
    - 一种交互式证明，其中证明方成功说服验证方：证明方知道某事，但同时除了该陈述外，不泄漏任何其他信息
    - 完备性：如果陈述是真的，那么诚实的验证方可以被诚实的证明方说服
    - 有效性：如果陈述是假的，那么没有作弊的证明方可以说服诚实的验证方
    - 存在性：如果单项函数存在，则存在对任意NP问题的零知识证明
    - 西格玛协议：分三轮：声明（承诺），挑战，响应。

22. 一个玩具例子
    - 魔法门咒语：知道魔法门咒语和读心术（预知验证者的挑战）之间不可区分
23. 汉弥尔顿环路的零知识证明
    - 知道环路和预知挑战之间不可区分
24. 零知识证明和承诺
    - 模拟范式：当一件事Y本来就可以从X得到，那么通过Y并不会从X额外获得什么
    - 在关于是否知道RSA私钥的零知识证明中，验证者给一个密文C后，让证明者给出对应明文M，来验证证明者知道私钥
      - 当没有承诺协议时，验证者可能在不知道明文M时直接给出一个密文C，而证明者返回的消息M令验证者额外知道了M；
      - 当加入承诺后时，证明者在给出M之前，先给出对M的承诺，即不泄漏M，又对后面给出的M作出承诺；在验证者提供M后，证明者知道验证者已经知道M了，根据上面的模拟范式可知，之后验证者获得的M对于验证者也不是新信息。
25. Schnorr协议
    - 之前学习过的Schnorr身份认证协议就是一个对离散对数问题的零知识证明
    - 知道离散对数的解和预知挑战之间不可区分
26. 破解RSA能力的零知识证明
    - 知道RSA问题的解和操纵挑战c之间不可区分

27. 健忘传输
    - 健忘传输：发送者不知道信息是否被传递
    - 社会学家百万富翁问题：两个数是否相同
    - Alice发送了4个消息，但不知道Bob得到哪一个消息

28. Rabin的健忘传输协议
    - Alice不知道Bob是否可以解密并获得消息

29. 二选一健忘传输
    - 知道收到了两个消息中的一个，但不知道具体是哪一个

30. 安全多方计算
    - 一群人来判断是否有人买单，但不知道每个人是否买单

31. 同态加密
    - 两个密文操作后，得到新密文；新密文解密后得到对应两个明文操作后的结果。

32. 端到端投票系统
    - 端到端投票系统
      - 投票：投票到投票机
      - 张贴：将票公开到公告烂
      - 计票：根据公告栏由选举官计票

    - 安全目标
      - 端到端可验证性：任何投票者确信按意愿投票，按投票来张贴，按张贴来计票
      - 隐私：没人知道投了什么票，甚至投票者也无法说服其他人她投了什么票；隐私意味着抗强迫

33. 三票投票法
    - 是否是安全的端到端投票
34. 量子密码学
    - 超态，相干，纠缠，不可测

35. 量子密码学现状
    - 并未证明量子计算机比经典图灵机强
    - 有多项式时间的算法用量子计算机解决难问题：整数分解，离散对数
    - 一些问题还没有多项式时间量子算法

36. 量子密钥分发
    - BB84 QKD
    - 窃听会影响量子传输，从而被监测发现
37. 总结：克拉克三定律之一：任何足够先进的技术和魔法是不可区分的。



